# 时光修复师 (Time Trace) 2.0 - 功能规划文档

## 1. 产品定位
**定位**：本地优先 (Local-First) 的专业修图交付工作台。
**核心环境**：Chrome Desktop (macOS)。利用 `FileSystem Access API` 实现直接读写本地磁盘。

## 2. 核心工作流 (Workflow)

### 2.1 启动与挂载
1.  **选择工作区 (Mount Workspace)**：
    *   用户点击“打开工作目录”。
    *   选择本地文件夹（如 `~/Pictures/RestorationProjects`）。
    *   应用获取该目录的读写权限，并扫描构建侧边栏索引。

### 2.2 导入与处理 (Import & Process)
1.  **导入素材**：
    *   通过拖拽或剪贴板粘贴 **原图** 和 **精修图(带水印)**。
    *   支持“粘贴替换”：随时粘贴新图替换当前精修版，系统自动实时去除水印。

### 2.3 归档保存 (Archive)
1.  **手动归档 (Save Project)**：
    *   用户点击“保存项目”。
    *   **配置**：选择现有用户或新建用户，设定项目名（默认时间戳）。
    *   **持久化**：
        *   路径：`[工作区]/[用户]/[项目名]/`
        *   内容：`original.[ext]` (原片), `clean.png` (去水印精修片)。

### 2.4 浏览与回顾 (Browse)
1.  **侧边栏索引 (Sidebar Tree)**：
    *   以“用户 > 项目”层级展示本地目录。
    *   点击项目，即刻从本地磁盘加载 `original` 和 `clean` 进行对比。
    *   *注：不提供平铺画廊模式，专注于单项目操作。*

### 2.5 导出交付 (Export & Deliver)
1.  **生成样片 (Export Preview)**：
    *   **选项**：尺寸限制（如长边 1080px）、内容（对比图/扫描视频）。
    *   **自动存储**：生成的样片文件直接写入本地：`[工作区]/[用户]/[项目名]/export/`。
    *   **目的**：方便修图师直接通过 Finder 将 `export` 文件夹内的内容发给客户。

## 3. 界面功能模块

### 3.1 侧边栏 (Sidebar)
*   工作区管理：显示当前挂载路径，一键刷新同步磁盘变更。
*   树形列表：管理用户文件夹和项目。

### 3.2 主舞台 (Stage)
*   **TimeTraceViewer**：
    *   **Lens**: 放大镜细节对比。
    *   **Scan**: 扫描线演示动画。
    *   **Split**: 左右全图滑块对比。

### 3.3 交互控制 (Console)
*   状态栏：显示当前图片分辨率、水印检测状态。
*   操作区：手动保存、导出样片、清理当前编辑区。

## 4. 技术栈
*   **FileSystem Access API**: 核心存储支撑。
*   **Canvas 2D**: 渲染与样片生成。
*   **Lucide Icons**: 界面图标。

---
**版本号**: 2.3-Final
**日期**: 2025-12-20
