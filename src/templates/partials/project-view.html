    <!-- 1. PROJECT VIEW (Header + Stage) -->
    <div id="projectView" class="flex-1 flex flex-col h-full">
        <!-- Header / Toolbar -->
        <header class="h-14 border-b border-gray-800 flex items-center justify-between px-6 bg-dark/50 backdrop-blur shrink-0">
          <div class="flex items-center gap-4">
            <button id="newProjectBtn" class="p-2 bg-gray-800 hover:bg-gray-700 text-gray-300 rounded-lg transition-colors" title="开始新项目">
                <i data-lucide="plus" class="w-4 h-4"></i>
            </button>
            <div class="h-6 w-px bg-gray-800"></div>
            <div id="activeProjectLabel" class="text-sm font-medium text-gray-400">请先选择或导入项目</div>
          </div>
          <div class="flex items-center gap-2">
            <!-- De-Watermark Toggle -->
            <label class="flex items-center gap-2 mr-4 cursor-pointer">
                <div class="relative">
                    <input type="checkbox" id="dewatermarkToggle" class="sr-only peer" checked>
                    <div class="w-9 h-5 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-primary"></div>
                </div>
                <span class="text-xs font-bold text-gray-400 select-none">自动去水印</span>
            </label>
            
            <button id="exportVideoBtn" class="px-4 py-1.5 bg-white/10 hover:bg-white/20 text-white rounded-lg text-xs font-bold transition-all flex items-center gap-2 mr-2" disabled>
              <i data-lucide="video" class="w-4 h-4"></i>
              导出视频
            </button>
            <button id="copyBtn" class="px-4 py-1.5 bg-white/10 hover:bg-white/20 text-white rounded-lg text-xs font-bold transition-all flex items-center gap-2 mr-2" disabled>
              <i data-lucide="clipboard-copy" class="w-4 h-4"></i>
              复制样片
            </button>
            <button id="exportBtn" class="px-4 py-1.5 bg-white/10 hover:bg-white/20 text-white rounded-lg text-xs font-bold transition-all flex items-center gap-2" disabled>
              <i data-lucide="image" class="w-4 h-4"></i>
              导出样片
            </button>
            <button id="saveBtn" class="px-4 py-1.5 bg-primary hover:bg-primary-hover text-white rounded-lg text-xs font-bold transition-all flex items-center gap-2" disabled>
              <i data-lucide="save" class="w-4 h-4"></i>
              归档保存
            </button>
          </div>
        </header>

        <div class="relative flex-1 overflow-hidden">
            <!-- Welcome Page -->
            <div id="welcomePage" class="absolute inset-0 z-40 bg-dark flex flex-col items-center justify-center p-8 overflow-y-auto">
              <div class="max-w-4xl w-full text-center">
                <h2 class="text-2xl font-bold mb-2">开始新项目</h2>
                <p class="text-gray-400 text-sm mb-10 leading-relaxed">请分别上传原始底片和修好的精修图（带水印），我们将自动去除水印。</p>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- Drop Zone: Original -->
                    <div id="dropZoneOriginal" class="relative group h-64 border-2 border-dashed border-gray-700 bg-gray-800/30 rounded-2xl flex flex-col items-center justify-center hover:border-primary/50 hover:bg-gray-800/50 transition-all cursor-pointer overflow-hidden">
                        <input type="file" id="inputOriginal" class="hidden" accept="image/*">
                        <div class="z-10 flex flex-col items-center pointer-events-none transition-opacity duration-300" id="contentOriginal">
                            <div class="w-16 h-16 bg-gray-700 rounded-full flex items-center justify-center mb-4 group-hover:scale-110 transition-transform">
                                <i data-lucide="image" class="w-8 h-8 text-gray-400"></i>
                            </div>
                            <span class="text-sm font-bold text-gray-300">上传原片 (Original)</span>
                            <span class="text-xs text-gray-500 mt-2">点击或拖拽至此</span>
                        </div>
                        <img id="previewThumbOriginal" class="absolute inset-0 w-full h-full object-cover opacity-40 hidden group-hover:opacity-20 transition-opacity">
                        <div id="statusOriginal" class="absolute bottom-4 right-4 hidden">
                            <i data-lucide="check-circle-2" class="w-6 h-6 text-primary"></i>
                        </div>
                    </div>

                    <!-- Drop Zone: Retouched -->
                    <div id="dropZoneRetouched" class="relative group h-64 border-2 border-dashed border-gray-700 bg-gray-800/30 rounded-2xl flex flex-col items-center justify-center hover:border-primary/50 hover:bg-gray-800/50 transition-all cursor-pointer overflow-hidden">
                        <input type="file" id="inputRetouched" class="hidden" accept="image/*">
                        <div class="z-10 flex flex-col items-center pointer-events-none transition-opacity duration-300" id="contentRetouched">
                            <div class="w-16 h-16 bg-gray-700 rounded-full flex items-center justify-center mb-4 group-hover:scale-110 transition-transform">
                                <i data-lucide="wand-2" class="w-8 h-8 text-amber-500"></i>
                            </div>
                            <span class="text-sm font-bold text-gray-300">上传精修图 (Retouched)</span>
                            <span class="text-xs text-gray-500 mt-2">带水印版本</span>
                        </div>
                        <img id="previewThumbRetouched" class="absolute inset-0 w-full h-full object-cover opacity-40 hidden group-hover:opacity-20 transition-opacity">
                        <div id="statusRetouched" class="absolute bottom-4 right-4 hidden">
                            <i data-lucide="check-circle-2" class="w-6 h-6 text-primary"></i>
                        </div>
                    </div>
                </div>

                <div id="startBtnContainer" class="mt-12 opacity-0 pointer-events-none transition-all duration-500 translate-y-4">
                    <button id="startProcessBtn" class="px-8 py-3 bg-primary hover:bg-primary-hover text-white rounded-xl text-sm font-bold shadow-lg shadow-primary/20 flex items-center gap-2 mx-auto transition-all transform hover:scale-105">
                        <i data-lucide="play" class="w-4 h-4 fill-current"></i>
                        开始去水印与验收
                    </button>
                </div>
              </div>
            </div>

            <!-- Content Stage -->
            <div id="stageContainer" class="absolute inset-0 overflow-y-auto p-8 space-y-12 no-scrollbar" style="display: none;">
              <div id="timeTraceContainer">
                <!-- TimeTrace sections will be injected here -->
                
                <!-- Zoom -->
                <section id="zoomSection" class="mb-12">
                    <div class="mb-4 flex flex-col md:flex-row justify-between md:items-end gap-2">
                        <div>
                            <h3 class="text-xl font-bold text-white flex items-center gap-2">
                               <span class="w-2 h-2 rounded-full bg-primary"></span> 高清细节透镜
                            </h3>
                            <p class="text-gray-400 text-sm mt-1">鼠标在左侧原图移动，右侧显示去水印细节</p>
                        </div>
                        <div class="flex items-center gap-4 bg-gray-800 border border-gray-700 px-4 py-2 rounded-lg text-xs text-gray-300 shadow-sm">
                            <span class="text-gray-500">透镜大小:</span>
                            <div class="flex items-center gap-2">
                                <i data-lucide="minus" class="w-3 h-3 text-gray-500"></i>
                                <input type="range" id="lensSizeSlider" min="1.5" max="6" step="0.1" value="3">
                                <i data-lucide="plus" class="w-3 h-3 text-gray-500"></i>
                            </div>
                            <span id="zoomLevelDisplay" class="font-mono text-primary w-12 text-right">3.0x</span>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="relative group rounded-xl overflow-hidden border border-gray-800 shadow-2xl bg-black">
                            <div class="absolute top-2 left-2 z-20 px-2 py-1 bg-black/70 backdrop-blur text-white text-[10px] rounded border border-white/10">ORIGINAL / 原片</div>
                            <div class="img-zoom-container" id="imgContainer">
                                <div id="zoomLens" class="img-zoom-lens"></div>
                                <img id="beforeImg" class="zoom-source-img" alt="Before">
                            </div>
                        </div>
                        <div class="relative h-full min-h-[400px] rounded-xl overflow-hidden border border-gray-800 shadow-2xl">
                            <div class="absolute top-2 right-2 z-20 px-2 py-1 bg-primary/90 backdrop-blur text-white text-[10px] rounded">CLEAN / 精修</div>
                            <div id="zoomResult" class="img-zoom-result bg-gray-900">
                                <div class="result-hint flex flex-col items-center gap-2">
                                    <i data-lucide="search" class="w-6 h-6"></i>
                                    <span>移动左侧透镜查看细节</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Scanner -->
                <section id="scanSection" class="mb-12 border-t border-gray-800 pt-12">
                    <div class="mb-6 flex flex-col md:flex-row justify-between items-end gap-4">
                        <div>
                            <h3 class="text-xl font-bold text-white flex items-center gap-2">
                                <i data-lucide="wand-2" class="text-primary w-5 h-5"></i> 智能修复演示
                            </h3>
                        </div>
                        <div class="flex flex-wrap gap-2 items-center">
                             <button id="btnPause" class="px-3 py-1.5 bg-gray-800 hover:bg-gray-700 text-white text-xs rounded border border-gray-700 flex items-center gap-2 transition-colors">
                                <i data-lucide="pause" class="w-3 h-3"></i> 暂停
                             </button>
                             <div class="relative flex items-center">
                                <i data-lucide="timer" class="absolute left-2 w-3 h-3 text-gray-500 z-10"></i>
                                <select id="scanSpeed" class="custom-select pl-7 pr-8 py-1.5 bg-gray-800 text-white text-xs rounded border border-gray-700 outline-none cursor-pointer">
                                    <option value="0.5">0.5x 慢速</option>
                                    <option value="1.0" selected>1.0x 默认</option>
                                    <option value="2.0">2.0x 快速</option>
                                </select>
                             </div>
                             <button id="scanDirH" class="px-3 py-1.5 bg-gray-800 text-white text-xs rounded border border-gray-700 transition-colors">↔ 横向</button>
                             <button id="scanDirV" class="px-3 py-1.5 bg-gray-800 text-white text-xs rounded border border-gray-700 transition-colors">↕ 纵向</button>
                        </div>
                    </div>
                    <div class="scanner-container bg-black" id="scannerContainer">
                        <div class="scanner-stage animate-scan-h" id="scannerStage">
                            <img id="scanBefore" class="scanner-base-img">
                            <div class="scan-line"></div>
                            <div class="scanner-reveal-wrapper" id="scannerWrapper">
                                <img id="scanAfter" class="scanner-reveal-img">
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Comparison -->
                <section id="comparisonSection" class="border-t border-gray-800 pt-12 pb-20">
                    <h3 class="text-xl font-bold text-white mb-6">全图效果比对</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                         <div class="relative bg-gray-900 rounded-xl p-2 border border-gray-800">
                             <img id="previewBefore" class="w-full h-auto max-h-[80vh] object-contain mx-auto rounded-lg">
                             <div class="absolute top-4 left-4 px-3 py-1 bg-black/60 backdrop-blur text-white text-[10px] font-bold rounded">BEFORE</div>
                         </div>
                         <div class="relative bg-gray-900 rounded-xl p-2 border border-gray-800">
                             <img id="previewAfter" class="w-full h-auto max-h-[80vh] object-contain mx-auto rounded-lg">
                             <div class="absolute top-4 left-4 px-3 py-1 bg-primary/90 backdrop-blur text-white text-[10px] font-bold rounded">AFTER</div>
                         </div>
                    </div>
                </section>
              </div>
            </div>
        </div>
    </div>
